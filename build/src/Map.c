/* Map.c generated by valac 0.34.8, the Vala compiler
 * generated from Map.gs, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <float.h>
#include <math.h>
#include <SDL2/SDL_render.h>
#include <SDL2/SDL_pixels.h>
#include <SDL2/SDL_rect.h>

typedef struct _Map Map;
typedef struct _sdxgraphicsSprite sdxgraphicsSprite;
#define _g_free0(var) (var = (g_free (var), NULL))
void sdx_graphics_sprite_release (sdxgraphicsSprite* self);
void sdx_graphics_sprite_free (sdxgraphicsSprite* self);
sdxgraphicsSprite* sdx_graphics_sprite_retain (sdxgraphicsSprite* self);
#define _sdx_graphics_sprite_release0(var) ((var == NULL) ? NULL : (var = (sdx_graphics_sprite_release (var), NULL)))
typedef struct _sdxfilesFileHandle sdxfilesFileHandle;

#define SDX_TYPE_FILE_TYPE (sdx_file_type_get_type ())
typedef struct _sdxutilsJsVariant sdxutilsJsVariant;

#define SDX_UTILS_TYPE_JS_TYPE (sdx_utils_js_type_get_type ())
void sdx_utils_js_variant_release (sdxutilsJsVariant* self);
void sdx_utils_js_variant_free (sdxutilsJsVariant* self);
sdxutilsJsVariant* sdx_utils_js_variant_retain (sdxutilsJsVariant* self);
#define _sdx_utils_js_variant_release0(var) ((var == NULL) ? NULL : (var = (sdx_utils_js_variant_release (var), NULL)))
typedef struct _sdxutilsFile sdxutilsFile;
typedef sdxgraphicsSprite sdxgraphicsSpriteTextureSprite;

#define SDX_GRAPHICS_TYPE_SCALE (sdx_graphics_scale_get_type ())
typedef struct _sdxgraphicsScale sdxgraphicsScale;

#define SDX_GRAPHICS_SPRITE_TYPE_KIND (sdx_graphics_sprite_kind_get_type ())
void sdx_files_file_handle_release (sdxfilesFileHandle* self);
void sdx_files_file_handle_free (sdxfilesFileHandle* self);
sdxfilesFileHandle* sdx_files_file_handle_retain (sdxfilesFileHandle* self);
#define _sdx_files_file_handle_release0(var) ((var == NULL) ? NULL : (var = (sdx_files_file_handle_release (var), NULL)))

#define TYPE_POINT2D (point2d_get_type ())
typedef struct _Point2d Point2d;

#define TYPE_VECTOR2D (vector2d_get_type ())
typedef struct _Vector2d Vector2d;
typedef struct _sdxgraphicsCamera sdxgraphicsCamera;

#define SDX_GRAPHICS_CAMERA_TYPE_KIND (sdx_graphics_camera_kind_get_type ())

struct _Map {
	gint retainCount__;
	gint width;
	gint height;
	gint tileheight;
	gint tilewidth;
	gchar* tileset;
	guint8* tiles;
	gint tiles_length1;
	sdxgraphicsSprite* sprite;
};

typedef enum  {
	SDX_FILE_TYPE_Resource = 1,
	SDX_FILE_TYPE_Asset,
	SDX_FILE_TYPE_Absolute,
	SDX_FILE_TYPE_Relative
} sdxFileType;

typedef enum  {
	SDX_UTILS_JS_TYPE_JS_INVALID,
	SDX_UTILS_JS_TYPE_JS_BOOLEAN,
	SDX_UTILS_JS_TYPE_JS_NUMBER,
	SDX_UTILS_JS_TYPE_JS_STRING,
	SDX_UTILS_JS_TYPE_JS_OBJECT,
	SDX_UTILS_JS_TYPE_JS_ARRAY
} sdxutilsJsType;

struct _sdxutilsJsVariant {
	gint _retainCount;
	gboolean boolean;
	gdouble number;
	gchar* string;
	GHashTable* object;
	GList* array;
	sdxutilsJsType type;
};

struct _sdxfilesFileHandle {
	gint _retainCount;
	sdxutilsFile* file;
	gchar* path;
	sdxFileType type;
};

struct _sdxgraphicsScale {
	gdouble x;
	gdouble y;
};

typedef enum  {
	SDX_GRAPHICS_SPRITE_KIND_AnimatedSprite,
	SDX_GRAPHICS_SPRITE_KIND_TextureSprite,
	SDX_GRAPHICS_SPRITE_KIND_AtlasSprite,
	SDX_GRAPHICS_SPRITE_KIND_CompositeSprite,
	SDX_GRAPHICS_SPRITE_KIND_TextSprite
} sdxgraphicsSpriteKind;

struct _sdxgraphicsSprite {
	gint _retainCount;
	gint id;
	SDL_Texture* texture;
	gint width;
	gint height;
	gint x;
	gint y;
	gint index;
	gint frame;
	sdxgraphicsScale scale;
	SDL_Color color;
	gboolean centered;
	gint layer;
	gchar* path;
	sdxgraphicsSpriteKind kind;
};

struct _Point2d {
	gdouble x;
	gdouble y;
};

struct _Vector2d {
	gdouble x;
	gdouble y;
};

typedef enum  {
	SDX_GRAPHICS_CAMERA_KIND_FluidCamera,
	SDX_GRAPHICS_CAMERA_KIND_InnerCamera,
	SDX_GRAPHICS_CAMERA_KIND_SimpleCamera
} sdxgraphicsCameraKind;

typedef void (*sdxgraphicsCameraCameraSetPosition) (Point2d* position, void* user_data);
struct _sdxgraphicsCamera {
	gint _retainCount;
	sdxgraphicsCameraKind kind;
	Vector2d position;
	sdxgraphicsCameraCameraSetPosition setPosition;
	gpointer setPosition_target;
	GDestroyNotify setPosition_target_destroy_notify;
};


extern sdxFileType sdx_platform;

void map_free (Map* self);
void sdx_graphics_sprite_free (sdxgraphicsSprite* self);
static void map_instance_init (Map * self);
#define MAP_AIR 0
#define MAP_START 79
#define MAP_FINISH 111
#define MAP_TILES_PER_ROW 16
Map* map_retain (Map* self);
void map_release (Map* self);
void map_free (Map* self);
Map* map_new (const gchar* mapPath);
void sdx_files_file_handle_free (sdxfilesFileHandle* self);
GType sdx_file_type_get_type (void) G_GNUC_CONST;
sdxfilesFileHandle* sdx_files_getHandle (const gchar* path, sdxFileType type);
void sdx_utils_js_variant_free (sdxutilsJsVariant* self);
sdxutilsJsVariant* sdx_utils_json_parse (const gchar* source);
gchar* sdx_files_file_handle_read (sdxfilesFileHandle* self);
sdxutilsJsVariant* sdx_utils_js_variant_member (sdxutilsJsVariant* self, const gchar* key);
GType sdx_utils_js_type_get_type (void) G_GNUC_CONST;
sdxutilsJsVariant* sdx_utils_js_variant_at (sdxutilsJsVariant* self, gint index);
void sdx_utils_file_free (sdxutilsFile* self);
gchar* sdx_utils_file_getParent (sdxutilsFile* self);
sdxgraphicsSpriteTextureSprite* sdx_graphics_sprite_texture_sprite_new (const gchar* path);
GType sdx_graphics_scale_get_type (void) G_GNUC_CONST;
sdxgraphicsScale* sdx_graphics_scale_dup (const sdxgraphicsScale* self);
void sdx_graphics_scale_free (sdxgraphicsScale* self);
GType sdx_graphics_sprite_kind_get_type (void) G_GNUC_CONST;
gint map_getTile (Map* self, gdouble x, gdouble y);
gdouble clamp (gdouble value, gdouble low, gdouble hi);
gboolean map_isSolid (Map* self, gdouble x, gdouble y);
GType point2d_get_type (void) G_GNUC_CONST;
Point2d* point2d_dup (const Point2d* self);
void point2d_free (Point2d* self);
GType vector2d_get_type (void) G_GNUC_CONST;
Vector2d* vector2d_dup (const Vector2d* self);
void vector2d_free (Vector2d* self);
gboolean map_isOnGround (Map* self, Point2d* pos, Vector2d* size);
gboolean map_isHit (Map* self, Point2d* pos, Vector2d* size);
void map_moveBox (Map* self, Point2d* pos, Vector2d* vel, Vector2d* size);
gdouble vector2d_len (Vector2d *self);
void point2d_add (Point2d *self, Vector2d* v, Point2d* result);
void vector2d_mul (Vector2d *self, gdouble f, Vector2d* result);
void sdx_graphics_camera_free (sdxgraphicsCamera* self);
void map_render (Map* self, sdxgraphicsCamera* camera);
void rect (gint x, gint y, gint h, gint w, SDL_Rect* result);
GType sdx_graphics_camera_kind_get_type (void) G_GNUC_CONST;
void sdx_graphics_sprite_copy (sdxgraphicsSprite* self, SDL_Rect* src, SDL_Rect* dest);


Map* map_retain (Map* self) {
	Map* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_atomic_int_add ((volatile gint *) (&self->retainCount__), 1);
	result = self;
	return result;
}


void map_release (Map* self) {
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	_tmp0_ = g_atomic_int_dec_and_test ((volatile gint *) (&self->retainCount__));
	if (_tmp0_) {
		map_free (self);
	}
}


/**
 * Load json map file created with Tiled
 */
static gpointer _sdx_utils_js_variant_retain0 (gpointer self) {
	return self ? sdx_utils_js_variant_retain (self) : NULL;
}


Map* map_new (const gchar* mapPath) {
	Map* self;
	sdxfilesFileHandle* map = NULL;
	const gchar* _tmp0_ = NULL;
	sdxFileType _tmp1_ = 0;
	sdxfilesFileHandle* _tmp2_ = NULL;
	sdxutilsJsVariant* json = NULL;
	sdxfilesFileHandle* _tmp3_ = NULL;
	gchar* _tmp4_ = NULL;
	gchar* _tmp5_ = NULL;
	sdxutilsJsVariant* _tmp6_ = NULL;
	sdxutilsJsVariant* _tmp7_ = NULL;
	sdxutilsJsVariant* _tmp8_ = NULL;
	sdxutilsJsVariant* _tmp9_ = NULL;
	sdxutilsJsVariant* _tmp10_ = NULL;
	gdouble _tmp11_ = 0.0;
	sdxutilsJsVariant* _tmp12_ = NULL;
	sdxutilsJsVariant* _tmp13_ = NULL;
	sdxutilsJsVariant* _tmp14_ = NULL;
	gdouble _tmp15_ = 0.0;
	sdxutilsJsVariant* _tmp16_ = NULL;
	sdxutilsJsVariant* _tmp17_ = NULL;
	sdxutilsJsVariant* _tmp18_ = NULL;
	gdouble _tmp19_ = 0.0;
	sdxutilsJsVariant* _tmp20_ = NULL;
	sdxutilsJsVariant* _tmp21_ = NULL;
	sdxutilsJsVariant* _tmp22_ = NULL;
	gdouble _tmp23_ = 0.0;
	sdxutilsJsVariant* _tmp24_ = NULL;
	sdxutilsJsVariant* _tmp25_ = NULL;
	sdxutilsJsVariant* _tmp26_ = NULL;
	sdxutilsJsVariant* _tmp27_ = NULL;
	sdxutilsJsVariant* _tmp28_ = NULL;
	sdxutilsJsVariant* _tmp29_ = NULL;
	sdxutilsJsVariant* _tmp30_ = NULL;
	const gchar* _tmp31_ = NULL;
	gchar* _tmp32_ = NULL;
	sdxfilesFileHandle* _tmp33_ = NULL;
	sdxutilsFile* _tmp34_ = NULL;
	gchar* _tmp35_ = NULL;
	gchar* _tmp36_ = NULL;
	gchar* _tmp37_ = NULL;
	gchar* _tmp38_ = NULL;
	const gchar* _tmp39_ = NULL;
	gchar* _tmp40_ = NULL;
	gchar* _tmp41_ = NULL;
	sdxgraphicsSpriteTextureSprite* _tmp42_ = NULL;
	sdxgraphicsSprite* _tmp43_ = NULL;
	sdxutilsJsVariant* data = NULL;
	sdxutilsJsVariant* _tmp44_ = NULL;
	sdxutilsJsVariant* _tmp45_ = NULL;
	sdxutilsJsVariant* _tmp46_ = NULL;
	sdxutilsJsVariant* _tmp47_ = NULL;
	sdxutilsJsVariant* _tmp48_ = NULL;
	sdxutilsJsVariant* _tmp49_ = NULL;
	sdxutilsJsVariant* _tmp50_ = NULL;
	sdxutilsJsVariant* _tmp51_ = NULL;
	GList* _tmp52_ = NULL;
	guint _tmp53_ = 0U;
	guint8* _tmp54_ = NULL;
	gint i = 0;
	sdxutilsJsVariant* _tmp55_ = NULL;
	GList* _tmp56_ = NULL;
	g_return_val_if_fail (mapPath != NULL, NULL);
	self = g_slice_new0 (Map);
	map_instance_init (self);
	_tmp0_ = mapPath;
	_tmp1_ = sdx_platform;
	_tmp2_ = sdx_files_getHandle (_tmp0_, _tmp1_);
	map = _tmp2_;
	_tmp3_ = map;
	_tmp4_ = sdx_files_file_handle_read (_tmp3_);
	_tmp5_ = _tmp4_;
	_tmp6_ = sdx_utils_json_parse (_tmp5_);
	_tmp7_ = _tmp6_;
	_g_free0 (_tmp5_);
	json = _tmp7_;
	_tmp8_ = json;
	_tmp9_ = sdx_utils_js_variant_member (_tmp8_, "width");
	_tmp10_ = _tmp9_;
	_tmp11_ = _tmp10_->number;
	self->width = (gint) _tmp11_;
	_sdx_utils_js_variant_release0 (_tmp10_);
	_tmp12_ = json;
	_tmp13_ = sdx_utils_js_variant_member (_tmp12_, "height");
	_tmp14_ = _tmp13_;
	_tmp15_ = _tmp14_->number;
	self->height = (gint) _tmp15_;
	_sdx_utils_js_variant_release0 (_tmp14_);
	_tmp16_ = json;
	_tmp17_ = sdx_utils_js_variant_member (_tmp16_, "tilewidth");
	_tmp18_ = _tmp17_;
	_tmp19_ = _tmp18_->number;
	self->tilewidth = (gint) _tmp19_;
	_sdx_utils_js_variant_release0 (_tmp18_);
	_tmp20_ = json;
	_tmp21_ = sdx_utils_js_variant_member (_tmp20_, "tileheight");
	_tmp22_ = _tmp21_;
	_tmp23_ = _tmp22_->number;
	self->tileheight = (gint) _tmp23_;
	_sdx_utils_js_variant_release0 (_tmp22_);
	_tmp24_ = json;
	_tmp25_ = sdx_utils_js_variant_member (_tmp24_, "tilesets");
	_tmp26_ = _tmp25_;
	_tmp27_ = sdx_utils_js_variant_at (_tmp26_, 0);
	_tmp28_ = _tmp27_;
	_tmp29_ = sdx_utils_js_variant_member (_tmp28_, "image");
	_tmp30_ = _tmp29_;
	_tmp31_ = _tmp30_->string;
	_tmp32_ = g_strdup (_tmp31_);
	_g_free0 (self->tileset);
	self->tileset = _tmp32_;
	_sdx_utils_js_variant_release0 (_tmp30_);
	_sdx_utils_js_variant_release0 (_tmp28_);
	_sdx_utils_js_variant_release0 (_tmp26_);
	_tmp33_ = map;
	_tmp34_ = _tmp33_->file;
	_tmp35_ = sdx_utils_file_getParent (_tmp34_);
	_tmp36_ = _tmp35_;
	_tmp37_ = g_strconcat (_tmp36_, "/", NULL);
	_tmp38_ = _tmp37_;
	_tmp39_ = self->tileset;
	_tmp40_ = g_strconcat (_tmp38_, _tmp39_, NULL);
	_tmp41_ = _tmp40_;
	_tmp42_ = sdx_graphics_sprite_texture_sprite_new (_tmp41_);
	_sdx_graphics_sprite_release0 (self->sprite);
	self->sprite = (sdxgraphicsSprite*) _tmp42_;
	_g_free0 (_tmp41_);
	_g_free0 (_tmp38_);
	_g_free0 (_tmp36_);
	_tmp43_ = self->sprite;
	_tmp43_->centered = FALSE;
	_tmp44_ = json;
	_tmp45_ = sdx_utils_js_variant_member (_tmp44_, "layers");
	_tmp46_ = _tmp45_;
	_tmp47_ = sdx_utils_js_variant_at (_tmp46_, 0);
	_tmp48_ = _tmp47_;
	_tmp49_ = sdx_utils_js_variant_member (_tmp48_, "data");
	_tmp50_ = _tmp49_;
	_sdx_utils_js_variant_release0 (_tmp48_);
	_sdx_utils_js_variant_release0 (_tmp46_);
	data = _tmp50_;
	_tmp51_ = data;
	_tmp52_ = _tmp51_->array;
	_tmp53_ = g_list_length (_tmp52_);
	_tmp54_ = g_new0 (guint8, _tmp53_);
	self->tiles = (g_free (self->tiles), NULL);
	self->tiles = _tmp54_;
	self->tiles_length1 = _tmp53_;
	i = 0;
	_tmp55_ = data;
	_tmp56_ = _tmp55_->array;
	{
		GList* d_collection = NULL;
		GList* d_it = NULL;
		d_collection = _tmp56_;
		for (d_it = d_collection; d_it != NULL; d_it = d_it->next) {
			sdxutilsJsVariant* _tmp57_ = NULL;
			sdxutilsJsVariant* d = NULL;
			_tmp57_ = _sdx_utils_js_variant_retain0 ((sdxutilsJsVariant*) d_it->data);
			d = _tmp57_;
			{
				guint8* _tmp58_ = NULL;
				gint _tmp58__length1 = 0;
				gint _tmp59_ = 0;
				sdxutilsJsVariant* _tmp60_ = NULL;
				gdouble _tmp61_ = 0.0;
				guint8 _tmp62_ = 0U;
				_tmp58_ = self->tiles;
				_tmp58__length1 = self->tiles_length1;
				_tmp59_ = i;
				i = _tmp59_ + 1;
				_tmp60_ = d;
				_tmp61_ = _tmp60_->number;
				_tmp58_[_tmp59_] = (guint8) _tmp61_;
				_tmp62_ = _tmp58_[_tmp59_];
				_sdx_utils_js_variant_release0 (d);
			}
		}
	}
	_sdx_utils_js_variant_release0 (data);
	_sdx_utils_js_variant_release0 (json);
	_sdx_files_file_handle_release0 (map);
	return self;
}


gint map_getTile (Map* self, gdouble x, gdouble y) {
	gint result = 0;
	gint nx = 0;
	gdouble _tmp0_ = 0.0;
	gint _tmp1_ = 0;
	gint _tmp2_ = 0;
	gdouble _tmp3_ = 0.0;
	gint ny = 0;
	gdouble _tmp4_ = 0.0;
	gint _tmp5_ = 0;
	gint _tmp6_ = 0;
	gdouble _tmp7_ = 0.0;
	gint pos = 0;
	gint _tmp8_ = 0;
	guint8* _tmp9_ = NULL;
	gint _tmp9__length1 = 0;
	guint8 _tmp10_ = 0U;
	g_return_val_if_fail (self != NULL, 0);
	_tmp0_ = x;
	_tmp1_ = self->tilewidth;
	_tmp2_ = self->width;
	_tmp3_ = clamp (_tmp0_ / _tmp1_, (gdouble) 0, (gdouble) (_tmp2_ - 1));
	nx = (gint) _tmp3_;
	_tmp4_ = y;
	_tmp5_ = self->tileheight;
	_tmp6_ = self->height;
	_tmp7_ = clamp (_tmp4_ / _tmp5_, (gdouble) 0, (gdouble) (_tmp6_ - 1));
	ny = (gint) _tmp7_;
	_tmp8_ = self->width;
	pos = (ny * _tmp8_) + nx;
	_tmp9_ = self->tiles;
	_tmp9__length1 = self->tiles_length1;
	_tmp10_ = _tmp9_[pos];
	result = (gint) _tmp10_;
	return result;
}


gboolean map_isSolid (Map* self, gdouble x, gdouble y) {
	gboolean result = FALSE;
	gdouble _tmp0_ = 0.0;
	gdouble _tmp1_ = 0.0;
	gint _tmp2_ = 0;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = x;
	_tmp1_ = y;
	_tmp2_ = map_getTile (self, _tmp0_, _tmp1_);
	switch (_tmp2_) {
		case MAP_AIR:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		case MAP_START:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		case MAP_FINISH:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		default:
		break;
	}
	result = TRUE;
	return result;
}


gboolean map_isOnGround (Map* self, Point2d* pos, Vector2d* size) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	Point2d _tmp1_ = {0};
	gdouble _tmp2_ = 0.0;
	Vector2d _tmp3_ = {0};
	gdouble _tmp4_ = 0.0;
	Point2d _tmp5_ = {0};
	gdouble _tmp6_ = 0.0;
	Vector2d _tmp7_ = {0};
	gdouble _tmp8_ = 0.0;
	gboolean _tmp9_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (pos != NULL, FALSE);
	g_return_val_if_fail (size != NULL, FALSE);
	_tmp1_ = *pos;
	_tmp2_ = _tmp1_.x;
	_tmp3_ = *size;
	_tmp4_ = _tmp3_.x;
	_tmp5_ = *pos;
	_tmp6_ = _tmp5_.y;
	_tmp7_ = *size;
	_tmp8_ = _tmp7_.y;
	_tmp9_ = map_isSolid (self, _tmp2_ - (_tmp4_ * 0.25), (_tmp6_ + (_tmp8_ * 0.25)) + 1);
	if (_tmp9_) {
		_tmp0_ = TRUE;
	} else {
		Point2d _tmp10_ = {0};
		gdouble _tmp11_ = 0.0;
		Vector2d _tmp12_ = {0};
		gdouble _tmp13_ = 0.0;
		Point2d _tmp14_ = {0};
		gdouble _tmp15_ = 0.0;
		Vector2d _tmp16_ = {0};
		gdouble _tmp17_ = 0.0;
		gboolean _tmp18_ = FALSE;
		_tmp10_ = *pos;
		_tmp11_ = _tmp10_.x;
		_tmp12_ = *size;
		_tmp13_ = _tmp12_.x;
		_tmp14_ = *pos;
		_tmp15_ = _tmp14_.y;
		_tmp16_ = *size;
		_tmp17_ = _tmp16_.y;
		_tmp18_ = map_isSolid (self, _tmp11_ + (_tmp13_ * 0.25), (_tmp15_ + (_tmp17_ * 0.25)) + 1);
		_tmp0_ = _tmp18_;
	}
	result = _tmp0_;
	return result;
}


gboolean map_isHit (Map* self, Point2d* pos, Vector2d* size) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	gboolean _tmp2_ = FALSE;
	Point2d _tmp3_ = {0};
	gdouble _tmp4_ = 0.0;
	Vector2d _tmp5_ = {0};
	gdouble _tmp6_ = 0.0;
	Point2d _tmp7_ = {0};
	gdouble _tmp8_ = 0.0;
	Vector2d _tmp9_ = {0};
	gdouble _tmp10_ = 0.0;
	gboolean _tmp11_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (pos != NULL, FALSE);
	g_return_val_if_fail (size != NULL, FALSE);
	_tmp3_ = *pos;
	_tmp4_ = _tmp3_.x;
	_tmp5_ = *size;
	_tmp6_ = _tmp5_.x;
	_tmp7_ = *pos;
	_tmp8_ = _tmp7_.y;
	_tmp9_ = *size;
	_tmp10_ = _tmp9_.y;
	_tmp11_ = map_isSolid (self, _tmp4_ - (_tmp6_ * 0.25), _tmp8_ - (_tmp10_ * 0.25));
	if (_tmp11_) {
		_tmp2_ = TRUE;
	} else {
		Point2d _tmp12_ = {0};
		gdouble _tmp13_ = 0.0;
		Vector2d _tmp14_ = {0};
		gdouble _tmp15_ = 0.0;
		Point2d _tmp16_ = {0};
		gdouble _tmp17_ = 0.0;
		Vector2d _tmp18_ = {0};
		gdouble _tmp19_ = 0.0;
		gboolean _tmp20_ = FALSE;
		_tmp12_ = *pos;
		_tmp13_ = _tmp12_.x;
		_tmp14_ = *size;
		_tmp15_ = _tmp14_.x;
		_tmp16_ = *pos;
		_tmp17_ = _tmp16_.y;
		_tmp18_ = *size;
		_tmp19_ = _tmp18_.y;
		_tmp20_ = map_isSolid (self, _tmp13_ + (_tmp15_ * 0.25), _tmp17_ - (_tmp19_ * 0.25));
		_tmp2_ = _tmp20_;
	}
	if (_tmp2_) {
		_tmp1_ = TRUE;
	} else {
		Point2d _tmp21_ = {0};
		gdouble _tmp22_ = 0.0;
		Vector2d _tmp23_ = {0};
		gdouble _tmp24_ = 0.0;
		Point2d _tmp25_ = {0};
		gdouble _tmp26_ = 0.0;
		Vector2d _tmp27_ = {0};
		gdouble _tmp28_ = 0.0;
		gboolean _tmp29_ = FALSE;
		_tmp21_ = *pos;
		_tmp22_ = _tmp21_.x;
		_tmp23_ = *size;
		_tmp24_ = _tmp23_.x;
		_tmp25_ = *pos;
		_tmp26_ = _tmp25_.y;
		_tmp27_ = *size;
		_tmp28_ = _tmp27_.y;
		_tmp29_ = map_isSolid (self, _tmp22_ - (_tmp24_ * 0.25), _tmp26_ + (_tmp28_ * 0.25));
		_tmp1_ = _tmp29_;
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		Point2d _tmp30_ = {0};
		gdouble _tmp31_ = 0.0;
		Vector2d _tmp32_ = {0};
		gdouble _tmp33_ = 0.0;
		Point2d _tmp34_ = {0};
		gdouble _tmp35_ = 0.0;
		Vector2d _tmp36_ = {0};
		gdouble _tmp37_ = 0.0;
		gboolean _tmp38_ = FALSE;
		_tmp30_ = *pos;
		_tmp31_ = _tmp30_.x;
		_tmp32_ = *size;
		_tmp33_ = _tmp32_.x;
		_tmp34_ = *pos;
		_tmp35_ = _tmp34_.y;
		_tmp36_ = *size;
		_tmp37_ = _tmp36_.y;
		_tmp38_ = map_isSolid (self, _tmp31_ + (_tmp33_ * 0.25), _tmp35_ + (_tmp37_ * 0.25));
		_tmp0_ = _tmp38_;
	}
	result = _tmp0_;
	return result;
}


/**
 * updates the position & velocity
 */
void map_moveBox (Map* self, Point2d* pos, Vector2d* vel, Vector2d* size) {
	gdouble distance = 0.0;
	gdouble _tmp0_ = 0.0;
	gdouble _tmp1_ = 0.0;
	g_return_if_fail (self != NULL);
	g_return_if_fail (pos != NULL);
	g_return_if_fail (vel != NULL);
	g_return_if_fail (size != NULL);
	_tmp0_ = vector2d_len (vel);
	distance = _tmp0_;
	_tmp1_ = distance;
	if (_tmp1_ < ((gdouble) 0)) {
		return;
	}
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp2_ = FALSE;
			_tmp2_ = TRUE;
			while (TRUE) {
				gdouble _tmp4_ = 0.0;
				Point2d newPos = {0};
				gdouble _tmp5_ = 0.0;
				Vector2d _tmp6_ = {0};
				Point2d _tmp7_ = {0};
				Point2d _tmp8_ = {0};
				Vector2d _tmp9_ = {0};
				gboolean _tmp10_ = FALSE;
				Point2d _tmp32_ = {0};
				if (!_tmp2_) {
					gint _tmp3_ = 0;
					_tmp3_ = i;
					i = _tmp3_ + 1;
				}
				_tmp2_ = FALSE;
				_tmp4_ = distance;
				if (!(i <= _tmp4_)) {
					break;
				}
				_tmp5_ = distance;
				vector2d_mul (vel, 1.0 / (_tmp5_ + 1.0), &_tmp6_);
				point2d_add (pos, &_tmp6_, &_tmp7_);
				newPos = _tmp7_;
				_tmp8_ = newPos;
				_tmp9_ = *size;
				_tmp10_ = map_isHit (self, &_tmp8_, &_tmp9_);
				if (_tmp10_) {
					gboolean hit = FALSE;
					Point2d _tmp11_ = {0};
					gdouble _tmp12_ = 0.0;
					Point2d _tmp13_ = {0};
					gdouble _tmp14_ = 0.0;
					Point2d _tmp15_ = {0};
					Vector2d _tmp16_ = {0};
					gboolean _tmp17_ = FALSE;
					Point2d _tmp20_ = {0};
					gdouble _tmp21_ = 0.0;
					Point2d _tmp22_ = {0};
					gdouble _tmp23_ = 0.0;
					Point2d _tmp24_ = {0};
					Vector2d _tmp25_ = {0};
					gboolean _tmp26_ = FALSE;
					gboolean _tmp29_ = FALSE;
					hit = FALSE;
					_tmp11_ = *pos;
					_tmp12_ = _tmp11_.x;
					_tmp13_ = newPos;
					_tmp14_ = _tmp13_.y;
					_tmp15_.x = _tmp12_;
					_tmp15_.y = _tmp14_;
					_tmp16_ = *size;
					_tmp17_ = map_isHit (self, &_tmp15_, &_tmp16_);
					if (_tmp17_) {
						Point2d _tmp18_ = {0};
						gdouble _tmp19_ = 0.0;
						_tmp18_ = *pos;
						_tmp19_ = _tmp18_.y;
						newPos.y = _tmp19_;
						(*vel).y = (gdouble) 0;
						hit = TRUE;
					}
					_tmp20_ = newPos;
					_tmp21_ = _tmp20_.x;
					_tmp22_ = *pos;
					_tmp23_ = _tmp22_.y;
					_tmp24_.x = _tmp21_;
					_tmp24_.y = _tmp23_;
					_tmp25_ = *size;
					_tmp26_ = map_isHit (self, &_tmp24_, &_tmp25_);
					if (_tmp26_) {
						Point2d _tmp27_ = {0};
						gdouble _tmp28_ = 0.0;
						_tmp27_ = *pos;
						_tmp28_ = _tmp27_.x;
						newPos.x = _tmp28_;
						(*vel).x = (gdouble) 0;
						hit = TRUE;
					}
					_tmp29_ = hit;
					if (!_tmp29_) {
						Point2d _tmp30_ = {0};
						Vector2d _tmp31_ = {0};
						_tmp30_ = *pos;
						newPos = _tmp30_;
						_tmp31_.x = (gdouble) 0;
						_tmp31_.y = (gdouble) 0;
						*vel = _tmp31_;
					}
				}
				_tmp32_ = newPos;
				*pos = _tmp32_;
			}
		}
	}
}


void map_render (Map* self, sdxgraphicsCamera* camera) {
	SDL_Rect clip = {0};
	gint _tmp0_ = 0;
	gint _tmp1_ = 0;
	SDL_Rect _tmp2_ = {0};
	SDL_Rect dest = {0};
	gint _tmp3_ = 0;
	gint _tmp4_ = 0;
	SDL_Rect _tmp5_ = {0};
	g_return_if_fail (self != NULL);
	g_return_if_fail (camera != NULL);
	_tmp0_ = self->tilewidth;
	_tmp1_ = self->tileheight;
	rect (0, 0, _tmp0_, _tmp1_, &_tmp2_);
	clip = _tmp2_;
	_tmp3_ = self->tilewidth;
	_tmp4_ = self->tileheight;
	rect (0, 0, _tmp3_, _tmp4_, &_tmp5_);
	dest = _tmp5_;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp6_ = FALSE;
			_tmp6_ = TRUE;
			while (TRUE) {
				guint8* _tmp8_ = NULL;
				gint _tmp8__length1 = 0;
				gint tileNr = 0;
				guint8* _tmp9_ = NULL;
				gint _tmp9__length1 = 0;
				gint _tmp10_ = 0;
				guint8 _tmp11_ = 0U;
				gint _tmp12_ = 0;
				gint _tmp13_ = 0;
				gint _tmp14_ = 0;
				gint _tmp15_ = 0;
				gint _tmp16_ = 0;
				gint _tmp17_ = 0;
				gint _tmp18_ = 0;
				gint _tmp19_ = 0;
				sdxgraphicsCamera* _tmp20_ = NULL;
				Vector2d _tmp21_ = {0};
				gdouble _tmp22_ = 0.0;
				gint _tmp23_ = 0;
				gint _tmp24_ = 0;
				gint _tmp25_ = 0;
				sdxgraphicsCamera* _tmp26_ = NULL;
				Vector2d _tmp27_ = {0};
				gdouble _tmp28_ = 0.0;
				sdxgraphicsSprite* _tmp29_ = NULL;
				SDL_Rect _tmp30_ = {0};
				SDL_Rect _tmp31_ = {0};
				if (!_tmp6_) {
					gint _tmp7_ = 0;
					_tmp7_ = i;
					i = _tmp7_ + 1;
				}
				_tmp6_ = FALSE;
				_tmp8_ = self->tiles;
				_tmp8__length1 = self->tiles_length1;
				if (!(i <= (_tmp8__length1 - 1))) {
					break;
				}
				_tmp9_ = self->tiles;
				_tmp9__length1 = self->tiles_length1;
				_tmp10_ = i;
				_tmp11_ = _tmp9_[_tmp10_];
				tileNr = (gint) _tmp11_;
				_tmp12_ = tileNr;
				if (_tmp12_ == MAP_AIR) {
					continue;
				}
				_tmp13_ = tileNr;
				_tmp14_ = self->tilewidth;
				clip.x = ((gint) ((_tmp13_ - 1) % MAP_TILES_PER_ROW)) * _tmp14_;
				_tmp15_ = tileNr;
				_tmp16_ = self->tileheight;
				clip.y = ((gint) ((_tmp15_ - 1) / MAP_TILES_PER_ROW)) * _tmp16_;
				_tmp17_ = i;
				_tmp18_ = self->width;
				_tmp19_ = self->tilewidth;
				_tmp20_ = camera;
				_tmp21_ = _tmp20_->position;
				_tmp22_ = _tmp21_.x;
				dest.x = ((_tmp17_ % _tmp18_) * ((gint) _tmp19_)) - ((gint) _tmp22_);
				_tmp23_ = i;
				_tmp24_ = self->width;
				_tmp25_ = self->tileheight;
				_tmp26_ = camera;
				_tmp27_ = _tmp26_->position;
				_tmp28_ = _tmp27_.y;
				dest.y = (((gint) (_tmp23_ / _tmp24_)) * ((gint) _tmp25_)) - ((gint) _tmp28_);
				_tmp29_ = self->sprite;
				_tmp30_ = clip;
				_tmp31_ = dest;
				sdx_graphics_sprite_copy (_tmp29_, &_tmp30_, &_tmp31_);
			}
		}
	}
}


static void map_instance_init (Map * self) {
	self->retainCount__ = 1;
}


void map_free (Map* self) {
	_g_free0 (self->tileset);
	self->tiles = (g_free (self->tiles), NULL);
	_sdx_graphics_sprite_release0 (self->sprite);
	g_slice_free (Map, self);
}



