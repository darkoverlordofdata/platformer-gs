/* Map.c generated by valac 0.34.8, the Vala compiler
 * generated from Map.gs, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <float.h>
#include <math.h>
#include <SDL2/SDL_render.h>
#include <SDL2/SDL_surface.h>
#include <SDL2/SDL_pixels.h>
#include <SDL2/SDL_rect.h>

typedef struct _Map Map;
typedef struct _sdxgraphicsSprite sdxgraphicsSprite;
#define _g_free0(var) (var = (g_free (var), NULL))
void sdx_graphics_sprite_release (sdxgraphicsSprite* self);
void sdx_graphics_sprite_free (sdxgraphicsSprite* self);
sdxgraphicsSprite* sdx_graphics_sprite_retain (sdxgraphicsSprite* self);
#define _sdx_graphics_sprite_release0(var) ((var == NULL) ? NULL : (var = (sdx_graphics_sprite_release (var), NULL)))
typedef struct _utilFile utilFile;
typedef struct _utilJsVariant utilJsVariant;

#define UTIL_TYPE_JS_TYPE (util_js_type_get_type ())
void util_js_variant_release (utilJsVariant* self);
void util_js_variant_free (utilJsVariant* self);
utilJsVariant* util_js_variant_retain (utilJsVariant* self);
#define _util_js_variant_release0(var) ((var == NULL) ? NULL : (var = (util_js_variant_release (var), NULL)))

#define SDX_GRAPHICS_TYPE_SCALE (sdx_graphics_scale_get_type ())
typedef struct _sdxgraphicsScale sdxgraphicsScale;
void util_file_release (utilFile* self);
void util_file_free (utilFile* self);
utilFile* util_file_retain (utilFile* self);
#define _util_file_release0(var) ((var == NULL) ? NULL : (var = (util_file_release (var), NULL)))

#define TYPE_POINT2D (point2d_get_type ())
typedef struct _Point2d Point2d;

#define TYPE_VECTOR2D (vector2d_get_type ())
typedef struct _Vector2d Vector2d;

#define TYPE_CAMERA (camera_get_type ())
typedef Vector2d Camera;

struct _Map {
	gint retainCount__;
	gint width;
	gint height;
	gint tileheight;
	gint tilewidth;
	gchar* tileset;
	guint8* tiles;
	gint tiles_length1;
	sdxgraphicsSprite* sprite;
};

typedef enum  {
	UTIL_JS_TYPE_JS_INVALID,
	UTIL_JS_TYPE_JS_BOOLEAN,
	UTIL_JS_TYPE_JS_NUMBER,
	UTIL_JS_TYPE_JS_STRING,
	UTIL_JS_TYPE_JS_OBJECT,
	UTIL_JS_TYPE_JS_ARRAY
} utilJsType;

struct _utilJsVariant {
	gint _retainCount;
	gboolean boolean;
	gdouble number;
	gchar* string;
	GHashTable* object;
	GList* array;
	utilJsType type;
};

struct _sdxgraphicsScale {
	gdouble x;
	gdouble y;
};

struct _sdxgraphicsSprite {
	gint _retainCount;
	SDL_Texture* texture;
	SDL_Surface* surface;
	gint width;
	gint height;
	gint x;
	gint y;
	sdxgraphicsScale scale;
	SDL_Color color;
	gboolean centered;
	gint layer;
	gint id;
	gchar* path;
	gboolean isText;
};

struct _Point2d {
	gdouble x;
	gdouble y;
};

struct _Vector2d {
	gdouble x;
	gdouble y;
};



void map_free (Map* self);
void sdx_graphics_sprite_free (sdxgraphicsSprite* self);
static void map_instance_init (Map * self);
#define MAP_AIR 0
#define MAP_START 79
#define MAP_FINISH 111
#define MAP_TILES_PER_ROW 16
Map* map_retain (Map* self);
void map_release (Map* self);
void map_free (Map* self);
Map* map_new (const gchar* mapPath);
void util_file_free (utilFile* self);
utilFile* util_file_new (const gchar* path);
void util_js_variant_free (utilJsVariant* self);
utilJsVariant* util_json_parse (const gchar* source);
gchar* util_file_read (utilFile* self);
utilJsVariant* util_js_variant_member (utilJsVariant* self, const gchar* key);
GType util_js_type_get_type (void) G_GNUC_CONST;
utilJsVariant* util_js_variant_at (utilJsVariant* self, gint index);
gchar* util_file_getParent (utilFile* self);
sdxgraphicsSprite* sdx_graphics_sprite_new (const gchar* path);
GType sdx_graphics_scale_get_type (void) G_GNUC_CONST;
sdxgraphicsScale* sdx_graphics_scale_dup (const sdxgraphicsScale* self);
void sdx_graphics_scale_free (sdxgraphicsScale* self);
gint map_getTile (Map* self, gdouble x, gdouble y);
gdouble clamp (gdouble value, gdouble low, gdouble hi);
gboolean map_isSolid (Map* self, gdouble x, gdouble y);
GType point2d_get_type (void) G_GNUC_CONST;
Point2d* point2d_dup (const Point2d* self);
void point2d_free (Point2d* self);
GType vector2d_get_type (void) G_GNUC_CONST;
Vector2d* vector2d_dup (const Vector2d* self);
void vector2d_free (Vector2d* self);
gboolean map_onGround (Map* self, Point2d* pos, Vector2d* size);
gboolean map_testBox (Map* self, Point2d* pos, Vector2d* size);
void map_moveBox (Map* self, Point2d* pos, Vector2d* vel, Vector2d* size);
gdouble vector2d_len (Vector2d *self);
void point2d_add (Point2d *self, Vector2d* v, Point2d* result);
void vector2d_mul (Vector2d *self, gdouble f, Vector2d* result);
GType camera_get_type (void) G_GNUC_CONST;
Camera* camera_dup (const Camera* self);
void camera_free (Camera* self);
void map_render (Map* self, Camera* camera);
void rect (gint x, gint y, gint h, gint w, SDL_Rect* result);
void sdx_graphics_sprite_copy (sdxgraphicsSprite* self, SDL_Rect* src, SDL_Rect* dest);


Map* map_retain (Map* self) {
	Map* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_atomic_int_add ((volatile gint *) (&self->retainCount__), 1);
	result = self;
	return result;
}


void map_release (Map* self) {
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	_tmp0_ = g_atomic_int_dec_and_test ((volatile gint *) (&self->retainCount__));
	if (_tmp0_) {
		map_free (self);
	}
}


/**
 * Load json map file created with Tiled
 */
static gpointer _util_js_variant_retain0 (gpointer self) {
	return self ? util_js_variant_retain (self) : NULL;
}


Map* map_new (const gchar* mapPath) {
	Map* self;
	utilFile* map = NULL;
	const gchar* _tmp0_ = NULL;
	utilFile* _tmp1_ = NULL;
	utilJsVariant* json = NULL;
	utilFile* _tmp2_ = NULL;
	gchar* _tmp3_ = NULL;
	gchar* _tmp4_ = NULL;
	utilJsVariant* _tmp5_ = NULL;
	utilJsVariant* _tmp6_ = NULL;
	utilJsVariant* _tmp7_ = NULL;
	utilJsVariant* _tmp8_ = NULL;
	utilJsVariant* _tmp9_ = NULL;
	gdouble _tmp10_ = 0.0;
	utilJsVariant* _tmp11_ = NULL;
	utilJsVariant* _tmp12_ = NULL;
	utilJsVariant* _tmp13_ = NULL;
	gdouble _tmp14_ = 0.0;
	utilJsVariant* _tmp15_ = NULL;
	utilJsVariant* _tmp16_ = NULL;
	utilJsVariant* _tmp17_ = NULL;
	gdouble _tmp18_ = 0.0;
	utilJsVariant* _tmp19_ = NULL;
	utilJsVariant* _tmp20_ = NULL;
	utilJsVariant* _tmp21_ = NULL;
	gdouble _tmp22_ = 0.0;
	utilJsVariant* _tmp23_ = NULL;
	utilJsVariant* _tmp24_ = NULL;
	utilJsVariant* _tmp25_ = NULL;
	utilJsVariant* _tmp26_ = NULL;
	utilJsVariant* _tmp27_ = NULL;
	utilJsVariant* _tmp28_ = NULL;
	utilJsVariant* _tmp29_ = NULL;
	const gchar* _tmp30_ = NULL;
	gchar* _tmp31_ = NULL;
	utilFile* _tmp32_ = NULL;
	gchar* _tmp33_ = NULL;
	gchar* _tmp34_ = NULL;
	gchar* _tmp35_ = NULL;
	gchar* _tmp36_ = NULL;
	const gchar* _tmp37_ = NULL;
	gchar* _tmp38_ = NULL;
	gchar* _tmp39_ = NULL;
	sdxgraphicsSprite* _tmp40_ = NULL;
	sdxgraphicsSprite* _tmp41_ = NULL;
	utilJsVariant* data = NULL;
	utilJsVariant* _tmp42_ = NULL;
	utilJsVariant* _tmp43_ = NULL;
	utilJsVariant* _tmp44_ = NULL;
	utilJsVariant* _tmp45_ = NULL;
	utilJsVariant* _tmp46_ = NULL;
	utilJsVariant* _tmp47_ = NULL;
	utilJsVariant* _tmp48_ = NULL;
	utilJsVariant* _tmp49_ = NULL;
	GList* _tmp50_ = NULL;
	guint _tmp51_ = 0U;
	guint8* _tmp52_ = NULL;
	gint i = 0;
	utilJsVariant* _tmp53_ = NULL;
	GList* _tmp54_ = NULL;
	g_return_val_if_fail (mapPath != NULL, NULL);
	self = g_slice_new0 (Map);
	map_instance_init (self);
	_tmp0_ = mapPath;
	_tmp1_ = util_file_new (_tmp0_);
	map = _tmp1_;
	_tmp2_ = map;
	_tmp3_ = util_file_read (_tmp2_);
	_tmp4_ = _tmp3_;
	_tmp5_ = util_json_parse (_tmp4_);
	_tmp6_ = _tmp5_;
	_g_free0 (_tmp4_);
	json = _tmp6_;
	_tmp7_ = json;
	_tmp8_ = util_js_variant_member (_tmp7_, "width");
	_tmp9_ = _tmp8_;
	_tmp10_ = _tmp9_->number;
	self->width = (gint) _tmp10_;
	_util_js_variant_release0 (_tmp9_);
	_tmp11_ = json;
	_tmp12_ = util_js_variant_member (_tmp11_, "height");
	_tmp13_ = _tmp12_;
	_tmp14_ = _tmp13_->number;
	self->height = (gint) _tmp14_;
	_util_js_variant_release0 (_tmp13_);
	_tmp15_ = json;
	_tmp16_ = util_js_variant_member (_tmp15_, "tilewidth");
	_tmp17_ = _tmp16_;
	_tmp18_ = _tmp17_->number;
	self->tilewidth = (gint) _tmp18_;
	_util_js_variant_release0 (_tmp17_);
	_tmp19_ = json;
	_tmp20_ = util_js_variant_member (_tmp19_, "tileheight");
	_tmp21_ = _tmp20_;
	_tmp22_ = _tmp21_->number;
	self->tileheight = (gint) _tmp22_;
	_util_js_variant_release0 (_tmp21_);
	_tmp23_ = json;
	_tmp24_ = util_js_variant_member (_tmp23_, "tilesets");
	_tmp25_ = _tmp24_;
	_tmp26_ = util_js_variant_at (_tmp25_, 0);
	_tmp27_ = _tmp26_;
	_tmp28_ = util_js_variant_member (_tmp27_, "image");
	_tmp29_ = _tmp28_;
	_tmp30_ = _tmp29_->string;
	_tmp31_ = g_strdup (_tmp30_);
	_g_free0 (self->tileset);
	self->tileset = _tmp31_;
	_util_js_variant_release0 (_tmp29_);
	_util_js_variant_release0 (_tmp27_);
	_util_js_variant_release0 (_tmp25_);
	_tmp32_ = map;
	_tmp33_ = util_file_getParent (_tmp32_);
	_tmp34_ = _tmp33_;
	_tmp35_ = g_strconcat (_tmp34_, "/", NULL);
	_tmp36_ = _tmp35_;
	_tmp37_ = self->tileset;
	_tmp38_ = g_strconcat (_tmp36_, _tmp37_, NULL);
	_tmp39_ = _tmp38_;
	_tmp40_ = sdx_graphics_sprite_new (_tmp39_);
	_sdx_graphics_sprite_release0 (self->sprite);
	self->sprite = _tmp40_;
	_g_free0 (_tmp39_);
	_g_free0 (_tmp36_);
	_g_free0 (_tmp34_);
	_tmp41_ = self->sprite;
	_tmp41_->centered = FALSE;
	_tmp42_ = json;
	_tmp43_ = util_js_variant_member (_tmp42_, "layers");
	_tmp44_ = _tmp43_;
	_tmp45_ = util_js_variant_at (_tmp44_, 0);
	_tmp46_ = _tmp45_;
	_tmp47_ = util_js_variant_member (_tmp46_, "data");
	_tmp48_ = _tmp47_;
	_util_js_variant_release0 (_tmp46_);
	_util_js_variant_release0 (_tmp44_);
	data = _tmp48_;
	_tmp49_ = data;
	_tmp50_ = _tmp49_->array;
	_tmp51_ = g_list_length (_tmp50_);
	_tmp52_ = g_new0 (guint8, _tmp51_);
	self->tiles = (g_free (self->tiles), NULL);
	self->tiles = _tmp52_;
	self->tiles_length1 = _tmp51_;
	i = 0;
	_tmp53_ = data;
	_tmp54_ = _tmp53_->array;
	{
		GList* d_collection = NULL;
		GList* d_it = NULL;
		d_collection = _tmp54_;
		for (d_it = d_collection; d_it != NULL; d_it = d_it->next) {
			utilJsVariant* _tmp55_ = NULL;
			utilJsVariant* d = NULL;
			_tmp55_ = _util_js_variant_retain0 ((utilJsVariant*) d_it->data);
			d = _tmp55_;
			{
				guint8* _tmp56_ = NULL;
				gint _tmp56__length1 = 0;
				gint _tmp57_ = 0;
				utilJsVariant* _tmp58_ = NULL;
				gdouble _tmp59_ = 0.0;
				guint8 _tmp60_ = 0U;
				_tmp56_ = self->tiles;
				_tmp56__length1 = self->tiles_length1;
				_tmp57_ = i;
				i = _tmp57_ + 1;
				_tmp58_ = d;
				_tmp59_ = _tmp58_->number;
				_tmp56_[_tmp57_] = (guint8) _tmp59_;
				_tmp60_ = _tmp56_[_tmp57_];
				_util_js_variant_release0 (d);
			}
		}
	}
	_util_js_variant_release0 (data);
	_util_js_variant_release0 (json);
	_util_file_release0 (map);
	return self;
}


gint map_getTile (Map* self, gdouble x, gdouble y) {
	gint result = 0;
	gint nx = 0;
	gdouble _tmp0_ = 0.0;
	gint _tmp1_ = 0;
	gint _tmp2_ = 0;
	gdouble _tmp3_ = 0.0;
	gint ny = 0;
	gdouble _tmp4_ = 0.0;
	gint _tmp5_ = 0;
	gint _tmp6_ = 0;
	gdouble _tmp7_ = 0.0;
	gint pos = 0;
	gint _tmp8_ = 0;
	guint8* _tmp9_ = NULL;
	gint _tmp9__length1 = 0;
	guint8 _tmp10_ = 0U;
	g_return_val_if_fail (self != NULL, 0);
	_tmp0_ = x;
	_tmp1_ = self->tilewidth;
	_tmp2_ = self->width;
	_tmp3_ = clamp (_tmp0_ / _tmp1_, (gdouble) 0, (gdouble) (_tmp2_ - 1));
	nx = (gint) _tmp3_;
	_tmp4_ = y;
	_tmp5_ = self->tileheight;
	_tmp6_ = self->height;
	_tmp7_ = clamp (_tmp4_ / _tmp5_, (gdouble) 0, (gdouble) (_tmp6_ - 1));
	ny = (gint) _tmp7_;
	_tmp8_ = self->width;
	pos = (ny * _tmp8_) + nx;
	_tmp9_ = self->tiles;
	_tmp9__length1 = self->tiles_length1;
	_tmp10_ = _tmp9_[pos];
	result = (gint) _tmp10_;
	return result;
}


gboolean map_isSolid (Map* self, gdouble x, gdouble y) {
	gboolean result = FALSE;
	gdouble _tmp0_ = 0.0;
	gdouble _tmp1_ = 0.0;
	gint _tmp2_ = 0;
	g_return_val_if_fail (self != NULL, FALSE);
	_tmp0_ = x;
	_tmp1_ = y;
	_tmp2_ = map_getTile (self, _tmp0_, _tmp1_);
	switch (_tmp2_) {
		case MAP_AIR:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		case MAP_START:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		case MAP_FINISH:
		{
			{
				result = FALSE;
				return result;
			}
			break;
		}
		default:
		break;
	}
	result = TRUE;
	return result;
}


gboolean map_onGround (Map* self, Point2d* pos, Vector2d* size) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	Point2d _tmp1_ = {0};
	gdouble _tmp2_ = 0.0;
	Vector2d _tmp3_ = {0};
	gdouble _tmp4_ = 0.0;
	Point2d _tmp5_ = {0};
	gdouble _tmp6_ = 0.0;
	Vector2d _tmp7_ = {0};
	gdouble _tmp8_ = 0.0;
	gboolean _tmp9_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (pos != NULL, FALSE);
	g_return_val_if_fail (size != NULL, FALSE);
	_tmp1_ = *pos;
	_tmp2_ = _tmp1_.x;
	_tmp3_ = *size;
	_tmp4_ = _tmp3_.x;
	_tmp5_ = *pos;
	_tmp6_ = _tmp5_.y;
	_tmp7_ = *size;
	_tmp8_ = _tmp7_.y;
	_tmp9_ = map_isSolid (self, _tmp2_ - (_tmp4_ * 0.25), (_tmp6_ + (_tmp8_ * 0.25)) + 1);
	if (_tmp9_) {
		_tmp0_ = TRUE;
	} else {
		Point2d _tmp10_ = {0};
		gdouble _tmp11_ = 0.0;
		Vector2d _tmp12_ = {0};
		gdouble _tmp13_ = 0.0;
		Point2d _tmp14_ = {0};
		gdouble _tmp15_ = 0.0;
		Vector2d _tmp16_ = {0};
		gdouble _tmp17_ = 0.0;
		gboolean _tmp18_ = FALSE;
		_tmp10_ = *pos;
		_tmp11_ = _tmp10_.x;
		_tmp12_ = *size;
		_tmp13_ = _tmp12_.x;
		_tmp14_ = *pos;
		_tmp15_ = _tmp14_.y;
		_tmp16_ = *size;
		_tmp17_ = _tmp16_.y;
		_tmp18_ = map_isSolid (self, _tmp11_ + (_tmp13_ * 0.25), (_tmp15_ + (_tmp17_ * 0.25)) + 1);
		_tmp0_ = _tmp18_;
	}
	result = _tmp0_;
	return result;
}


gboolean map_testBox (Map* self, Point2d* pos, Vector2d* size) {
	gboolean result = FALSE;
	gboolean _tmp0_ = FALSE;
	gboolean _tmp1_ = FALSE;
	gboolean _tmp2_ = FALSE;
	Point2d _tmp3_ = {0};
	gdouble _tmp4_ = 0.0;
	Vector2d _tmp5_ = {0};
	gdouble _tmp6_ = 0.0;
	Point2d _tmp7_ = {0};
	gdouble _tmp8_ = 0.0;
	Vector2d _tmp9_ = {0};
	gdouble _tmp10_ = 0.0;
	gboolean _tmp11_ = FALSE;
	g_return_val_if_fail (self != NULL, FALSE);
	g_return_val_if_fail (pos != NULL, FALSE);
	g_return_val_if_fail (size != NULL, FALSE);
	_tmp3_ = *pos;
	_tmp4_ = _tmp3_.x;
	_tmp5_ = *size;
	_tmp6_ = _tmp5_.x;
	_tmp7_ = *pos;
	_tmp8_ = _tmp7_.y;
	_tmp9_ = *size;
	_tmp10_ = _tmp9_.y;
	_tmp11_ = map_isSolid (self, _tmp4_ - (_tmp6_ * 0.25), _tmp8_ - (_tmp10_ * 0.25));
	if (_tmp11_) {
		_tmp2_ = TRUE;
	} else {
		Point2d _tmp12_ = {0};
		gdouble _tmp13_ = 0.0;
		Vector2d _tmp14_ = {0};
		gdouble _tmp15_ = 0.0;
		Point2d _tmp16_ = {0};
		gdouble _tmp17_ = 0.0;
		Vector2d _tmp18_ = {0};
		gdouble _tmp19_ = 0.0;
		gboolean _tmp20_ = FALSE;
		_tmp12_ = *pos;
		_tmp13_ = _tmp12_.x;
		_tmp14_ = *size;
		_tmp15_ = _tmp14_.x;
		_tmp16_ = *pos;
		_tmp17_ = _tmp16_.y;
		_tmp18_ = *size;
		_tmp19_ = _tmp18_.y;
		_tmp20_ = map_isSolid (self, _tmp13_ + (_tmp15_ * 0.25), _tmp17_ - (_tmp19_ * 0.25));
		_tmp2_ = _tmp20_;
	}
	if (_tmp2_) {
		_tmp1_ = TRUE;
	} else {
		Point2d _tmp21_ = {0};
		gdouble _tmp22_ = 0.0;
		Vector2d _tmp23_ = {0};
		gdouble _tmp24_ = 0.0;
		Point2d _tmp25_ = {0};
		gdouble _tmp26_ = 0.0;
		Vector2d _tmp27_ = {0};
		gdouble _tmp28_ = 0.0;
		gboolean _tmp29_ = FALSE;
		_tmp21_ = *pos;
		_tmp22_ = _tmp21_.x;
		_tmp23_ = *size;
		_tmp24_ = _tmp23_.x;
		_tmp25_ = *pos;
		_tmp26_ = _tmp25_.y;
		_tmp27_ = *size;
		_tmp28_ = _tmp27_.y;
		_tmp29_ = map_isSolid (self, _tmp22_ - (_tmp24_ * 0.25), _tmp26_ + (_tmp28_ * 0.25));
		_tmp1_ = _tmp29_;
	}
	if (_tmp1_) {
		_tmp0_ = TRUE;
	} else {
		Point2d _tmp30_ = {0};
		gdouble _tmp31_ = 0.0;
		Vector2d _tmp32_ = {0};
		gdouble _tmp33_ = 0.0;
		Point2d _tmp34_ = {0};
		gdouble _tmp35_ = 0.0;
		Vector2d _tmp36_ = {0};
		gdouble _tmp37_ = 0.0;
		gboolean _tmp38_ = FALSE;
		_tmp30_ = *pos;
		_tmp31_ = _tmp30_.x;
		_tmp32_ = *size;
		_tmp33_ = _tmp32_.x;
		_tmp34_ = *pos;
		_tmp35_ = _tmp34_.y;
		_tmp36_ = *size;
		_tmp37_ = _tmp36_.y;
		_tmp38_ = map_isSolid (self, _tmp31_ + (_tmp33_ * 0.25), _tmp35_ + (_tmp37_ * 0.25));
		_tmp0_ = _tmp38_;
	}
	result = _tmp0_;
	return result;
}


void map_moveBox (Map* self, Point2d* pos, Vector2d* vel, Vector2d* size) {
	gdouble distance = 0.0;
	gdouble _tmp0_ = 0.0;
	gint maximum = 0;
	gdouble _tmp1_ = 0.0;
	gdouble _tmp2_ = 0.0;
	gdouble fraction = 0.0;
	gint _tmp3_ = 0;
	g_return_if_fail (self != NULL);
	g_return_if_fail (pos != NULL);
	g_return_if_fail (vel != NULL);
	g_return_if_fail (size != NULL);
	_tmp0_ = vector2d_len (vel);
	distance = _tmp0_;
	_tmp1_ = distance;
	maximum = (gint) _tmp1_;
	_tmp2_ = distance;
	if (_tmp2_ < ((gdouble) 0)) {
		return;
	}
	_tmp3_ = maximum;
	fraction = 1.0 / ((gdouble) (_tmp3_ + 1));
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp4_ = FALSE;
			_tmp4_ = TRUE;
			while (TRUE) {
				gint _tmp6_ = 0;
				Point2d newPos = {0};
				gdouble _tmp7_ = 0.0;
				Vector2d _tmp8_ = {0};
				Point2d _tmp9_ = {0};
				Point2d _tmp10_ = {0};
				Vector2d _tmp11_ = {0};
				gboolean _tmp12_ = FALSE;
				Point2d _tmp34_ = {0};
				if (!_tmp4_) {
					gint _tmp5_ = 0;
					_tmp5_ = i;
					i = _tmp5_ + 1;
				}
				_tmp4_ = FALSE;
				_tmp6_ = maximum;
				if (!(i <= _tmp6_)) {
					break;
				}
				_tmp7_ = fraction;
				vector2d_mul (vel, _tmp7_, &_tmp8_);
				point2d_add (pos, &_tmp8_, &_tmp9_);
				newPos = _tmp9_;
				_tmp10_ = newPos;
				_tmp11_ = *size;
				_tmp12_ = map_testBox (self, &_tmp10_, &_tmp11_);
				if (_tmp12_) {
					gboolean hit = FALSE;
					Point2d _tmp13_ = {0};
					gdouble _tmp14_ = 0.0;
					Point2d _tmp15_ = {0};
					gdouble _tmp16_ = 0.0;
					Point2d _tmp17_ = {0};
					Vector2d _tmp18_ = {0};
					gboolean _tmp19_ = FALSE;
					Point2d _tmp22_ = {0};
					gdouble _tmp23_ = 0.0;
					Point2d _tmp24_ = {0};
					gdouble _tmp25_ = 0.0;
					Point2d _tmp26_ = {0};
					Vector2d _tmp27_ = {0};
					gboolean _tmp28_ = FALSE;
					gboolean _tmp31_ = FALSE;
					hit = FALSE;
					_tmp13_ = *pos;
					_tmp14_ = _tmp13_.x;
					_tmp15_ = newPos;
					_tmp16_ = _tmp15_.y;
					_tmp17_.x = _tmp14_;
					_tmp17_.y = _tmp16_;
					_tmp18_ = *size;
					_tmp19_ = map_testBox (self, &_tmp17_, &_tmp18_);
					if (_tmp19_) {
						Point2d _tmp20_ = {0};
						gdouble _tmp21_ = 0.0;
						_tmp20_ = *pos;
						_tmp21_ = _tmp20_.y;
						newPos.y = _tmp21_;
						(*vel).y = (gdouble) 0;
						hit = TRUE;
					}
					_tmp22_ = newPos;
					_tmp23_ = _tmp22_.x;
					_tmp24_ = *pos;
					_tmp25_ = _tmp24_.y;
					_tmp26_.x = _tmp23_;
					_tmp26_.y = _tmp25_;
					_tmp27_ = *size;
					_tmp28_ = map_testBox (self, &_tmp26_, &_tmp27_);
					if (_tmp28_) {
						Point2d _tmp29_ = {0};
						gdouble _tmp30_ = 0.0;
						_tmp29_ = *pos;
						_tmp30_ = _tmp29_.x;
						newPos.x = _tmp30_;
						(*vel).x = (gdouble) 0;
						hit = TRUE;
					}
					_tmp31_ = hit;
					if (!_tmp31_) {
						Point2d _tmp32_ = {0};
						Vector2d _tmp33_ = {0};
						_tmp32_ = *pos;
						newPos = _tmp32_;
						_tmp33_.x = (gdouble) 0;
						_tmp33_.y = (gdouble) 0;
						*vel = _tmp33_;
					}
				}
				_tmp34_ = newPos;
				*pos = _tmp34_;
			}
		}
	}
}


void map_render (Map* self, Camera* camera) {
	SDL_Rect clip = {0};
	gint _tmp0_ = 0;
	gint _tmp1_ = 0;
	SDL_Rect _tmp2_ = {0};
	SDL_Rect dest = {0};
	gint _tmp3_ = 0;
	gint _tmp4_ = 0;
	SDL_Rect _tmp5_ = {0};
	g_return_if_fail (self != NULL);
	g_return_if_fail (camera != NULL);
	_tmp0_ = self->tilewidth;
	_tmp1_ = self->tileheight;
	rect (0, 0, _tmp0_, _tmp1_, &_tmp2_);
	clip = _tmp2_;
	_tmp3_ = self->tilewidth;
	_tmp4_ = self->tileheight;
	rect (0, 0, _tmp3_, _tmp4_, &_tmp5_);
	dest = _tmp5_;
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp6_ = FALSE;
			_tmp6_ = TRUE;
			while (TRUE) {
				guint8* _tmp8_ = NULL;
				gint _tmp8__length1 = 0;
				gint tileNr = 0;
				guint8* _tmp9_ = NULL;
				gint _tmp9__length1 = 0;
				gint _tmp10_ = 0;
				guint8 _tmp11_ = 0U;
				gint _tmp12_ = 0;
				gint _tmp13_ = 0;
				gint _tmp14_ = 0;
				gint _tmp15_ = 0;
				gint _tmp16_ = 0;
				gint _tmp17_ = 0;
				gint _tmp18_ = 0;
				gint _tmp19_ = 0;
				Camera _tmp20_ = {0};
				gdouble _tmp21_ = 0.0;
				gint _tmp22_ = 0;
				gint _tmp23_ = 0;
				gint _tmp24_ = 0;
				Camera _tmp25_ = {0};
				gdouble _tmp26_ = 0.0;
				sdxgraphicsSprite* _tmp27_ = NULL;
				SDL_Rect _tmp28_ = {0};
				SDL_Rect _tmp29_ = {0};
				if (!_tmp6_) {
					gint _tmp7_ = 0;
					_tmp7_ = i;
					i = _tmp7_ + 1;
				}
				_tmp6_ = FALSE;
				_tmp8_ = self->tiles;
				_tmp8__length1 = self->tiles_length1;
				if (!(i <= (_tmp8__length1 - 1))) {
					break;
				}
				_tmp9_ = self->tiles;
				_tmp9__length1 = self->tiles_length1;
				_tmp10_ = i;
				_tmp11_ = _tmp9_[_tmp10_];
				tileNr = (gint) _tmp11_;
				_tmp12_ = tileNr;
				if (_tmp12_ == MAP_AIR) {
					continue;
				}
				_tmp13_ = tileNr;
				_tmp14_ = self->tilewidth;
				clip.x = ((gint) ((_tmp13_ - 1) % MAP_TILES_PER_ROW)) * _tmp14_;
				_tmp15_ = tileNr;
				_tmp16_ = self->tileheight;
				clip.y = ((gint) ((_tmp15_ - 1) / MAP_TILES_PER_ROW)) * _tmp16_;
				_tmp17_ = i;
				_tmp18_ = self->width;
				_tmp19_ = self->tilewidth;
				_tmp20_ = *camera;
				_tmp21_ = _tmp20_.x;
				dest.x = ((_tmp17_ % _tmp18_) * ((gint) _tmp19_)) - ((gint) _tmp21_);
				_tmp22_ = i;
				_tmp23_ = self->width;
				_tmp24_ = self->tileheight;
				_tmp25_ = *camera;
				_tmp26_ = _tmp25_.y;
				dest.y = (((gint) (_tmp22_ / _tmp23_)) * ((gint) _tmp24_)) - ((gint) _tmp26_);
				_tmp27_ = self->sprite;
				_tmp28_ = clip;
				_tmp29_ = dest;
				sdx_graphics_sprite_copy (_tmp27_, &_tmp28_, &_tmp29_);
			}
		}
	}
}


static void map_instance_init (Map * self) {
	self->retainCount__ = 1;
}


void map_free (Map* self) {
	_g_free0 (self->tileset);
	self->tiles = (g_free (self->tiles), NULL);
	_sdx_graphics_sprite_release0 (self->sprite);
	g_slice_free (Map, self);
}



