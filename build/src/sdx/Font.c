/* Font.c generated by valac 0.34.8, the Vala compiler
 * generated from Font.vala, do not modify */


#include <glib.h>
#include <glib-object.h>
#include <stdlib.h>
#include <string.h>
#include <SDL_ttf.h>
#include <SDL2/SDL_rwops.h>
#include <SDL2/SDL_pixels.h>
#include <SDL2/SDL_surface.h>

typedef struct _sdxFont sdxFont;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _TTF_CloseFont0(var) ((var == NULL) ? NULL : (var = (TTF_CloseFont (var), NULL)))
#define _SDL_FreeRW0(var) ((var == NULL) ? NULL : (var = (SDL_FreeRW (var), NULL)))
typedef struct _sdxfilesFileHandle sdxfilesFileHandle;
void sdx_files_file_handle_release (sdxfilesFileHandle* self);
void sdx_files_file_handle_free (sdxfilesFileHandle* self);
sdxfilesFileHandle* sdx_files_file_handle_retain (sdxfilesFileHandle* self);
#define _sdx_files_file_handle_release0(var) ((var == NULL) ? NULL : (var = (sdx_files_file_handle_release (var), NULL)))

struct _sdxFont {
	gint _retainCount;
	gint id;
	gchar* path;
	gint size;
	TTF_Font* innerFont;
	SDL_RWops* raw;
};


extern gint sdx_font_uniqueId;
gint sdx_font_uniqueId = 0;

void sdx_font_free (sdxFont* self);
static void sdx_font_instance_init (sdxFont * self);
sdxFont* sdx_font_retain (sdxFont* self);
void sdx_font_release (sdxFont* self);
void sdx_font_free (sdxFont* self);
sdxFont* sdx_font_new (const gchar* path, gint size);
void sdx_files_file_handle_free (sdxfilesFileHandle* self);
sdxfilesFileHandle* sdx_files_default (const gchar* path);
SDL_RWops* sdx_files_file_handle_getRWops (sdxfilesFileHandle* self);
SDL_Surface* sdx_font_render (sdxFont* self, const gchar* text, SDL_Color color);


sdxFont* sdx_font_retain (sdxFont* self) {
	sdxFont* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_atomic_int_add ((volatile gint *) (&self->_retainCount), 1);
	result = self;
	return result;
}


void sdx_font_release (sdxFont* self) {
	gboolean _tmp0_ = FALSE;
	g_return_if_fail (self != NULL);
	_tmp0_ = g_atomic_int_dec_and_test ((volatile gint *) (&self->_retainCount));
	if (_tmp0_) {
		sdx_font_free (self);
	}
}


sdxFont* sdx_font_new (const gchar* path, gint size) {
	sdxFont* self;
	sdxfilesFileHandle* file = NULL;
	const gchar* _tmp0_ = NULL;
	sdxfilesFileHandle* _tmp1_ = NULL;
	SDL_RWops* _tmp2_ = NULL;
	SDL_RWops* _tmp3_ = NULL;
	gint _tmp4_ = 0;
	TTF_Font* _tmp5_ = NULL;
	const gchar* _tmp6_ = NULL;
	gchar* _tmp7_ = NULL;
	gint _tmp8_ = 0;
	g_return_val_if_fail (path != NULL, NULL);
	self = g_slice_new0 (sdxFont);
	sdx_font_instance_init (self);
	_tmp0_ = path;
	_tmp1_ = sdx_files_default (_tmp0_);
	file = _tmp1_;
	_tmp2_ = sdx_files_file_handle_getRWops (file);
	_SDL_FreeRW0 (self->raw);
	self->raw = _tmp2_;
	_tmp3_ = self->raw;
	_tmp4_ = size;
	_tmp5_ = TTF_OpenFontRW (_tmp3_, 0, _tmp4_);
	_TTF_CloseFont0 (self->innerFont);
	self->innerFont = _tmp5_;
	_tmp6_ = path;
	_tmp7_ = g_strdup (_tmp6_);
	_g_free0 (self->path);
	self->path = _tmp7_;
	_tmp8_ = size;
	self->size = _tmp8_;
	_sdx_files_file_handle_release0 (file);
	return self;
}


/**
 *  Render text for Sprite.fromRenderedText
 *
 * @param text to generate surface from
 * @param color foreground color of text
 * @return new Surface
 */
SDL_Surface* sdx_font_render (sdxFont* self, const gchar* text, SDL_Color color) {
	SDL_Surface* result = NULL;
	TTF_Font* _tmp0_ = NULL;
	const gchar* _tmp1_ = NULL;
	SDL_Color _tmp2_ = {0};
	SDL_Surface* _tmp3_ = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (text != NULL, NULL);
	_tmp0_ = self->innerFont;
	_tmp1_ = text;
	_tmp2_ = color;
	_tmp3_ = TTF_RenderUTF8_Solid (_tmp0_, _tmp1_, _tmp2_);
	result = _tmp3_;
	return result;
}


static void sdx_font_instance_init (sdxFont * self) {
	gint _tmp0_ = 0;
	gint _tmp1_ = 0;
	self->_retainCount = 1;
	_tmp0_ = sdx_font_uniqueId;
	sdx_font_uniqueId = _tmp0_ + 1;
	_tmp1_ = sdx_font_uniqueId;
	self->id = _tmp1_;
}


void sdx_font_free (sdxFont* self) {
	_g_free0 (self->path);
	_TTF_CloseFont0 (self->innerFont);
	_SDL_FreeRW0 (self->raw);
	g_slice_free (sdxFont, self);
}



